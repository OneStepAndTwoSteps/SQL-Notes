## 索引概况

### what is index?

*   数据库中的索引，就好比一本书的目录，它可以帮我们快速进行特定值的定位与查找，从而加快数据查询的效率。

*   一句话：索引就是帮助数据库管理系统高效获取数据的数据结构。如果我们不使用索引，就必须从第 1 条记录开始扫描，直到把所有的数据表都扫描完，才能找到想要的数据。

### 索引不是万能的

但是索引不是万能的，有些时候使用索引会造成效率变低，如：

*   __1、__ 在数据表中的数据行数比较少的情况下，比如不到 1000 行，是不需要创建索引的

*   __2、__ 当数据重复度大，比如高于 10% 的时候，也不需要对这个字段使用索引。
    
    比如性别字段，就不需要创建索引，因为你想要在 100 万行数据中查找其中的 50 万行（比如性别为男的数据），一旦创建了索引，你需要先访问 50 万次索引，然后再访问 50 万次数据表，这样加起来的开销比不使用索引可能还要大。

    __注意：__ 需要结合数值的分布来判别，比如在数据中 99990 的人都是女生，只有10个人是男生，此时对性别加上索引，查找男生时速度会更快一些。

### 索引的种类有哪些？

#### 功能逻辑层面

从功能逻辑上说，索引主要有 4 种，分别是普通索引、唯一索引、主键索引和全文索引。

*   __普通索引：__ 

    是基础的索引，没有任何约束，主要用于提高查询效率。
    
*   __唯一索引：__ 

    就是在普通索引的基础上增加了数据唯一性的约束，在一张数据表里可以有多个唯一索引。
    
*   __主键索引：__ 
    
    在唯一索引的基础上增加了不为空的约束，也就是 NOT NULL+UNIQUE，一张表里最多只有一个主键索引。

    在一张数据表中只能有一个主键索引，这是由主键索引的物理实现方式决定的，因为数据存储在文件中只能按照一种顺序进行存储。但可以有多个普通索引或者多个唯一索引。
*   __全文索引：__ 
    
    用的不多，MySQL 自带的全文索引只支持英文。我们通常可以采用专门的全文搜索引擎，比如 ES(ElasticSearch) 和 Solr。
 
#### 物理实现方式

按照物理实现方式，索引可以分为 2 种：聚集索引和非聚集索引（非聚集索引也称为二级索引或者辅助索引）

*   __聚集索引：__
    
    聚集索引可以按照主键来排序存储数据，这样在查找行的时候非常有效。
    
    聚集索引指表中数据行按索引的排序方式进行存储，对查找行很有效。只有当表包含聚集索引时，表内的数据行才会按找索引列的值在磁盘上进行物理排序和存储。每一个表只能有一个聚集索引，因为数据行本身只能按一个顺序存储。

*   __非聚集索引：__
    
    在数据库系统会有单独的存储空间存放非聚集索引，这些索引项是按照顺序存储的，但索引项指向的内容是随机存储的。

    也就是说系统会进行两次查找，第一次先找到索引，第二次找到索引对应的位置取出数据行(也就是要进行回表操作)。
    
    非聚集索引不会把索引指向的内容像聚集索引一样直接放到索引的后面，而是维护单独的索引表（只维护索引，不维护索引指向的数据），为数据检索提供方便。


*   __聚集索引与非聚集索引的原理不同，在使用上也有一些区别：__

    __1、__ 聚集索引的叶子节点存储的就是我们的数据记录，非聚集索引的叶子节点存储的是主键的值。非聚集索引不会影响数据表的物理存储顺序。

    __2、__ 一个表只能有一个聚集索引，因为只能有一种排序存储的方式，但可以有多个非聚集索引，也就是多个索引目录提供数据检索。

    __3、__ 使用聚集索引的时候，数据的查询效率高，但如果对数据进行插入，删除，更新等操作，效率会比非聚集索引低。(因为聚集索引是有序的，插入或者更新需要重新排序)


#### 按照字段个数划分

索引还可以按照字段个数进行划分，分成单一索引和联合索引。

*   __单一索引：__ 
    
    索引列为一列时为单一索引；

*   __联合索引：__
    
    多个列组合在一起创建的索引叫做联合索引。

__联合索引的最左原则：__

*   当我们使用了联合索引 (user_id, user_name) 的时候，在 WHERE 子句中对联合索引中的字段 user_id 和 user_name 进行条件查询，或者只对 user_id 进行查询，效率基本上是一样的。

    但是当我们对 user_name 进行条件查询时，效率就会降低很多，这是因为根据联合索引的最左原则，user_id 在 user_name 的左侧，如果没有使用 user_id，而是直接使用 user_name 进行条件查询，联合索引就会失效。

### 总结：

*   使用索引可以帮助我们从海量的数据中快速定位想要查找的数据，不过索引也存在一些不足，比如占用存储空间、降低数据库写操作的性能等，如果有多个索引还会增加索引选择的时间。

    所以当我们使用索引时，需要平衡索引的利（提升查询效率）和弊（维护索引所需的代价）。



### 补充扩展

[关于索引的面试题](https://zhuanlan.zhihu.com/p/78982303)

[深入浅出数据库索引原理](https://zhuanlan.zhihu.com/p/23624390)