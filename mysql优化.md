# mysql中优化注意事项


## 表设计优化

*   表结构要尽量遵循第三范式的原则

*   注意数据类型的选择，这关系到查询效率和数据库存储空间大小，一般的，如果可以使用数值类型就不要采用字符类型，对于字符类型，我们应该设置合适的长度，确定字符长度时可以采用char，长度不确定一般采用varchar


##  在查询数据时需注意

*   逻辑优化查询

    *   对于 EXSIT 语句和 IN 语句查询来说，会根据小表驱动大表的形式
    
    *   对于 WHERE 语句，如果在使用它进行查询时，我们尽量不要在 WHERE 语句中包含对字段的函数运算。因为它会使字段索引失效。

*   物理优化查询，它的核心是高效地建立索引，并通过这些索引来做各种优化。

    *   索引使用的注意事项

        *   如果数据重复度高，就不需要建立索引，一般以重复度是否超过10%作为条件。比如只存在(0，1)的字段。

        *   不在 WHERE 语句中使用表达式计算，这会造成索引失效。

        *   使用联合索引时需要注意联合索引的引用顺序，比如我们创建了 (a,b,c) 三个字段的联合索引，但是我们在执行的时候 使用 (c,b,a) 这样的查询方法，那么就不会使用到索引。

        *   适当的索引，索引会消耗我们的存储，同时过多的索引会导致优化器在进行评估的时候增加了筛选出索引的计算时间，影响评估的效率。


*   SQL 查询优化大方向上可以分成逻辑查询优化和物理查询优化。

    *   逻辑查询优化就是通过 SQL 等价变换提升查询效率，也就是换成另外一种查询写法执行效率更高的语句。

    *   而物理查询优化则是通过索引和表连接方式等技术来进行优化，这里重点需要掌握索引的使用。


##  借助外部工具实现缓存功能

*   比如 redis 和 memcache


##  库级别优化

*   使用主从模式，读写分离

*   数据库分表分库

    *   垂直切分
        
        *   如果数据库中的 __数据表过多__，可以采用垂直分库的方式，将关联的数据表部署在一个数据库上。

        *   如果数据 __表中的列过多__，可以采用垂直分表的方式，将数据表分拆成多张，把经常一起使用的列放到同一张表里。

    *   水平切分

        *   如果数据表中的 __数据量非常大__ 比如达到了亿级以上，可以考虑水平切分，将大的数据表分拆成不同的子表，每张表保持相同的表结构。
            
            比如你可以按照年份来划分，把不同年份的数据放到不同的数据表中。2017 年、2018 年和 2019 年的数据就可以分别放到三张数据表中。