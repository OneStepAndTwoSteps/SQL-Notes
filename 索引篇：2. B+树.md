# B+树

* MySQL 使用B+树作为索引

* 影响 MySQL 查询的速度的一个重要指标：__IO次数__。

    我们通过索引来查找某行数据的时候，需要计算产生的磁盘 I/O 次数，当磁盘 I/O 次数越多，所消耗的时间也就越大。如果我们能让索引的数据结构尽量减少硬盘的 I/O 操作，所消耗的时间也就越小。

## 二叉树

二叉树是每个节点最多有两个子节点的树。

二叉树里面又分完全二叉树、平衡二叉树、满二叉树。

这里我们讨论平衡二叉树，平衡二叉搜索树，搜索时间复杂度就是 O(log2n)。

如果使用二叉树来作为索引就会有这样的问题，二叉树的每个节点下只能再分两个子节点，所以当n很大时深度可能会比较深，每访问一次节点就需要进行一次磁盘 I/O 操作。

所以虽然平衡二叉树比较的效率高，但是树的深度也同样高，这就意味着磁盘 I/O 操作次数多，会影响整体数据查询的效率。

## B树

如果用二叉树作为索引的实现结构，会让树变得很高，增加硬盘的 I/O 次数，影响数据查询的时间。

因此一个节点就不能只有 2 个子节点，而应该允许有 M 个子节点 (M>2)。B 树的出现就是为了解决这个问题，B 树的高度远小于平衡二叉树的高度。

在文件系统和数据库系统中的索引结构经常采用 B 树来实现。


## B+树

B+ 树基于 B 树做出了改进，主流的 DBMS 都支持 B+ 树的索引方式，比如 MySQL。B+ 树和 B 树的差异在于以下几点：

*   __1、__ 有 k 个孩子的节点就有 k 个关键字。也就是孩子数量 = 关键字数，而 B 树中，孩子数量 = 关键字数 +1。

*   __2、__ 非叶子节点的关键字也会同时存在在子节点中，并且是在子节点中所有关键字的最大（或最小）。

*   __3、__ 非叶子节点仅用于索引，不保存数据记录，跟记录有关的信息都放在叶子节点中。而 B 树中，非叶子节点既保存索引，也保存数据记录。

*   __4、__ 所有关键字都在叶子节点出现，叶子节点构成一个有序链表，而且叶子节点本身按照关键字的大小从小到大顺序链接。


## B树和B+树

B+ 树和 B 树有个根本的差异在于，B+ 树的中间节点并不直接存储数据，这样的设计使得：

__1、B+ 树查询效率更稳定__

*   因为 B+ 树每次只有访问到叶子节点才能找到对应的数据，而在 B 树中，非叶子节点也会存储数据，这样就会造成查询效率不稳定的情况，有时候访问到了非叶子节点就可以找到关键字，而有时需要访问到叶子节点才能找到关键字。

__2、B+ 树的查询效率更高__

*   B+ 树比 B 树更矮胖（阶数更大，深度更低），查询所需要的磁盘 I/O 也会更少。同样的磁盘页大小，B+ 树可以存储更多的节点关键字（因为B+树的非叶子节点不存储数据）。

__3、在查询范围上，B+ 树的效率也比 B 树高__

*   这是因为所有关键字都出现在 B+ 树的叶子节点中，并通过有序链表进行了链接。而在 B 树中则需要通过中序遍历才能完成查询范围的查找，效率要低很多。